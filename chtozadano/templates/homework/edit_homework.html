{% extends "base.html" %}

{% block content %}
	{% load static %}
	<br>
	<table border="1">
		<tr>
			<td>Класс</td>
			<td>Литера</td>
			<td>Описание</td>
			<td>Предмет</td>
			<td>Дата создания</td>
			<td>Изображения</td>
			<td>Файлы</td>
		</tr>
		<tr>
			<td>{{ hw_info.grade }}</td>
			<td>{{ hw_info.letter }}</td>
			<form method="POST" enctype="multipart/form-data">
				{% csrf_token %}
				<td><textarea name="description">{{ hw_info.description }}</textarea></td>
				<td>
					<label for="subject">Выберите предмет:</label>
					<select name="subject">
						{% for subject in subjects %}
							{% if subject == subject_now %}
								<option selected="selected" value="{{ subject }}">{{ subject }}</option>
							{% else %}
								<option value="{{ subject }}">{{ subject }}</option>
							{% endif %}
						{% endfor %}
					</select>
				</td>
				<td>{{ hw_info.created_at }}</td>
				<td>
					{% for j in hw_info.images.all %}
						<img src="{{ j.image.url }}" width="500" height="500">
						<a href="{% url "homework:edit_files_homework" hw_info.id "img" j.id %}">
							<button type="button">Удалить</button>
						</a>
					{% endfor %}
				</td>
				<td>
					{% for j in hw_info.files.all %}
						<a href="{{ j.file.url }}"><p>№{{ forloop.counter }}: {{ j.file_name }}</p></a>
						<a href="{% url "homework:edit_files_homework" hw_info.id "file" j.id %}">
							<button type="button">Удалить</button>
						</a>
					{% endfor %}
				</td>
		</tr>
	</table>
	<div class="container">
		<input type="file" id="file-input" onchange="preview()" multiple name="files">
		<label for="file-input">
			<i class="fas fa-upload"></i> &nbsp; Выберите файлы
		</label>
		<p id="num-of-files">Файлы не выбраны</p>
		<div id="images"></div>
	</div>
	<script>
        let fileInput = document.getElementById("file-input");
        let imageContainer = document.getElementById("images");
        let numOfFiles = document.getElementById("num-of-files");

        function preview() {
            imageContainer.innerHTML = "";
            numOfFiles.textContent = `${fileInput.files.length} Files Selected`;

            for (i of fileInput.files) {
                let reader = new FileReader();
                let figure = document.createElement("figure");
                let figCap = document.createElement("figcaption");
                figCap.innerText = i.name;
                figure.appendChild(figCap);
                reader.onload = () => {
                    if (reader.result.split(":")[1].startsWith("image")) {
                        let img = document.createElement("img");
                        img.setAttribute("src", reader.result);
                        img.setAttribute("width", 500);
                        figure.insertBefore(img, figCap);
                    } else {
                        let img = document.createElement("img");
                        img.setAttribute("src", "{% static "file_image.png" %}");
                        img.setAttribute("width", 100);
                        figure.insertBefore(img, figCap);
                    }
                }
                imageContainer.appendChild(figure);
                reader.readAsDataURL(i);
            }
        }
	</script>
	<button type="submit">Сохранить</button>
	</form>
	<a href="{% url "homework:homework_page" %}">
		<button>Вернуться</button>
	</a>
{% endblock %}